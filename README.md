# Распределённая CLI-утилита cut с кворумом и concurrency

Этот проект представляет собой распределённую версию классической CLI-утилиты `cut` на языке Go. Утилита поддерживает работу в многосерверном режиме с использованием кворума для обеспечения надёжности и параллелизма для повышения производительности.

## Описание

Проект реализует распределённую обработку данных с помощью утилиты `cut`, которая извлекает указанные поля из строк входного потока. Каждый экземпляр сервиса обрабатывает часть данных, обменивается результатами через сеть и достигает консенсуса при помощи кворума (например, N/2+1 серверов успешно обработали свой фрагмент).

Основные компоненты:
- **Клиент (cmd/main.go)**: Парсит аргументы командной строки и координирует распределённую обработку.
- **Сервер (cmd/server/server.go)**: Обрабатывает HTTP-запросы на обработку фрагментов данных.
- **Логика cut (pkg/cut/)**: Реализует основную функциональность утилиты cut.
- **Сервис (pkg/service/)**: Обрабатывает входные данные и применяет логику cut.
- **Флаги (pkg/flags/)**: Парсит аргументы командной строки.

## Особенности

- **Распределённая обработка**: Данные разбиваются на фрагменты и обрабатываются несколькими серверами параллельно.
- **Кворум**: Результат считается валидным, если N/2+1 серверов успешно обработали свои фрагменты.
- **Concurrency**: Используются горутины и каналы для параллелизма внутри каждого сервера и обмена данными между ними.
- **HTTP-коммуникация**: Серверы обмениваются данными через HTTP POST-запросы.
- **Поддержка флагов**: Аналогично оригинальной утилите cut: `-f` для выбора полей, `-d` для разделителя, `-s` для подавления строк без разделителей.

## Архитектура

- **Клиент**: Читает входной поток, разбивает на фрагменты, отправляет на серверы, собирает результаты и проверяет кворум.
- **Серверы**: Принимают фрагменты данных, обрабатывают их с помощью логики cut и возвращают результаты.
- **Параллелизм**: Горутины используются для одновременной отправки запросов на несколько серверов и обработки ответов.
- **Каналы**: Для синхронизации и передачи данных между горутинами.

## Установка и запуск

### Требования

- Go
- Docker и Docker Compose (для запуска серверов)

### Сборка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Komilov31/distributed-cut.git
   cd distributed-cut
   ```

2. Соберите проект:
   ```bash
   docker compose up -d
   go build -o mycut cmd/main.go
   ```

Серверы будут запущены на портах 8080, 8081 и 8082.

### Запуск клиента

```bash
./mycut -f 1,2,3 input.txt
```

## Использование

Утилита поддерживает те же флаги, что и оригинальная `cut`:

- `-f <fields>`: Выбрать только эти поля (обязательный флаг).
- `-d <delimiter>`: Использовать разделитель вместо табуляции (по умолчанию `\t`).
- `-s`: Не печатать строки, не содержащие разделителей.

Пример:
```bash
./mycut -f 1,3 -d "," input.csv
```

## Примеры

### Пример 1: Извлечение полей из CSV-файла

```bash
echo -e "name,age,city\nJohn,25,NYC\nJane,30,LA" | ./mycut -f 1,3 -d ","
```

Вывод:
```
name,city
John,NYC
Jane,LA
```

## Сравнение с оригинальной утилитой

- **Оригинальная cut**: Обрабатывает данные последовательно на одном узле.
- **Распределённая версия**: Разбивает данные на фрагменты, обрабатывает параллельно на нескольких серверах, собирает результаты с кворумом.

## TODO
## Тестирование

Проект включает интеграционные тесты для сравнения с оригинальной утилитой cut.

Запуск тестов:
```bash
make test
```
